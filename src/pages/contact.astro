---
import BaseLayout from "../layouts/BaseLayout.astro";
const API = "/api/contact"; // same-origin
---

<BaseLayout title="Contact">
  <section class="prose prose-invert max-w-3xl mx-auto py-14">
    <h1>Contact</h1>
    <p>Or email me at <a href="mailto:viktor@holovin.com">viktor@holovin.com</a>.</p>

    <form id="contactForm" class="not-prose mt-6 flex flex-col gap-4 max-w-md">
      <input name="name" required placeholder="Your name"
             class="rounded-lg bg-white/5 px-4 py-2 border border-white/20" />
      <input type="email" name="email" required placeholder="Your email"
             class="rounded-lg bg-white/5 px-4 py-2 border border-white/20" />
      <textarea name="message" rows="5" required placeholder="Your message"
                class="rounded-lg bg-white/5 px-4 py-2 border border-white/20"></textarea>

      <!-- honeypot -->
      <input type="text" name="company" class="hidden" autocomplete="off" />

      <button class="rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 px-6 py-3 text-white font-medium">
        Send
      </button>
      <p id="status" class="text-sm opacity-80"></p>
    </form>

    <script>
      const f = document.getElementById('contactForm');
      const status = document.getElementById('status');
      f?.addEventListener('submit', async (e) => {
        e.preventDefault();
        status.textContent = 'Sending...';
        const payload = Object.fromEntries(new FormData(f));
        try {
          const res = await fetch({API}, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          if (res.ok) {
            f.reset();
            status.textContent = 'Thanks! Iâ€™ll reply soon.';
          } else {
            const { error } = await res.json().catch(()=>({ error: 'Failed' }));
            status.textContent = 'Failed: ' + (error || 'Please try again.');
          }
        } catch {
          status.textContent = 'Network error. Please try again.';
        }
      });
    </script>
  </section>
</BaseLayout>
